<html>
<head>

    <title>IoT Control Panel</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">    
    <style>
    title {
        font-size: 15px;
        font-family: 'Roboto', sans-serif;
        text-shadow: 4px 4px 4px #aaa;
    }


    </style>
</head>
<body>

    <div style="text-align: center; padding-bottom: 10px; margin-left: 25%; margin-top: 15px; width: 50%;">
        <h2>IoT Control panel</h2>

        <p><b>Total number of motions detected: </b><span id = totalMotionP>0</span></p>
        <p><b>Total number of long motions detected: </b><span id = totalLMotionP>0</span></p>
        <p><b>Total number of short motions detected: </b><span id = totalSMotionP>0</span></p>

        <div style="width: 250px;margin:0 auto;padding-bottom: 2%">
            <span style="float: left;"><b>Delay:</b></span>
            <input class="mdl-slider mdl-js-slider" type="range" min="6" max="25" value="6" tabindex="0" oninput="showMessage(this.value)" onchange="showMessage(this.value)">
            <span style="float: right;margin-top: -20px;" id="delayThreshold">6</span>
        </div>
 

        <button id = 'toggleLedButton' class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            <span id = 'tLBSpan'>Enable</span>
            led
        </button>


        <button id = 'toggleMotionButton' class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            <span id = 'tMBSpan'>Enable</span>
            motion sensor
        </button>
    </div>
   

    <script src="socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-pink.min.css" />


    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript">
        function showMessage(value){
         document.getElementById("delayThreshold").innerHTML = value;
        }

    </script>

    <script>

        (function(){
          'use strict';
            var socket = io.connect("http://127.0.0.1:3000"),

                $ledToggleBtn = $('#toggleLedButton'),
                $ledStatus = $('#tLBSpan', $ledToggleBtn),
                ledStatus = true,

                $motionToggleBtn = $('#toggleMotionButton'),
                $motionToggleStatus = $('#tMBSpan', $motionToggleBtn),
                motionToggleStatus = 'Disable',

                $totalMotions = $('#totalMotionP'),
                $totalShortMotions = $('#totalSMotionP'),
                $totalLongMotions = $('#totalLMotionP'),

                $delayThreshold = $('#delayThreshold'),

                toggleLedStatus = function() {
                    if(ledStatus){ 
                        socket.emit('toggleLed', false);
                        $ledStatus.text("Enable"); 
                        ledStatus = false;
                    }
                    else{
                        socket.emit('toggleLed', true);
                        $ledStatus.text("Disable"); 
                        ledStatus = true;
                    }
                },

                toggleMotionStatus = function(){
                    if(motionToggleStatus){ 
                        socket.emit('motionSensorStatus', false);
                        $motionToggleStatus.text("Enable"); 
                        motionToggleStatus = false;
                    }
                    else{
                        socket.emit('motionSensorStatus', true);
                        $motionToggleStatus.text("Disable"); 
                        motionToggleStatus = true;
                    }
                },

                updateData = function(data){
                    $totalMotions.text(data["totalMotions"]);
                    $totalShortMotions.text(data["shortMotions"]);
                    $totalLongMotions.text(data["longMotions"]);

                    $delayThreshold.text(data["motionTimeout"]);
                    //todo: motionTimeout


                    if(data["ledStatus"] == true){
                        $ledStatus.text("Disable");
                        ledStatus = true;
                    }
                    else{
                        $ledStatus.text("Enable");
                        ledStatus = false;
                    }

                    if(data["motionSensorStatus"] == true){
                        $motionToggleStatus.text("Disable");
                        motionToggleStatus = true;
                    }
                    else{
                        $motionToggleStatus.text("Enable");
                        motionToggleStatus = false;
                    }

                };
            
            // Listeners
            socket.on('update', updateData);
            $ledToggleBtn.on('click', toggleLedStatus);
            $motionToggleBtn.on('click', toggleMotionStatus);

        }());    


    </script>


</body>
</html>
